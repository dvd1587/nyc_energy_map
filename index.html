<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NYC Buildings Energy & Water Use Map</title>
  <meta name="description" content="Explore NYC building energy and water performance data">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23141a16' width='100' height='100' rx='20'/><path fill='%2310b981' d='M25 85V30h20v55h-20zm30 0V15h20v70h-20z'/></svg>">
  
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <!-- MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
  
  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="app">
    <!-- Mobile Toggle Button -->
    <button class="sidebar-toggle" id="sidebarToggle">
      <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path d="M3 12h18M3 6h18M3 18h18"/>
      </svg>
    </button>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="header">
        <div class="header-content">
          <div class="header-icon">
            <svg width="26" height="26" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
              <path d="M3 21h18M9 8h1M9 12h1M9 16h1M14 8h1M14 12h1M14 16h1M5 21V5a2 2 0 012-2h10a2 2 0 012 2v16"/>
            </svg>
          </div>
          <div>
            <h1>NYC Buildings Energy & Water Use Map</h1>
            <p>Local Law 84 Data Disclosure: <a href="https://data.cityofnewyork.us/Environment/NYC-Building-Energy-and-Water-Data-Disclosure-for-/5zyy-y8am" target="_blank">NYC Open Data</a></p>
            <p><em>Last Updated: November 2025</em></p>
          </div>
        </div>
      </div>
      
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-value" id="avgEui">--</div>
          <div class="stat-label">AVG EUI</div>
          <div class="stat-unit">(kBtu/ft²)</div>
          <div class="stat-sample" id="euiSample"></div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgWui">--</div>
          <div class="stat-label">AVG WUI</div>
          <div class="stat-unit">(gal/ft²)</div>
          <div class="stat-sample" id="wuiSample"></div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgGhg">--</div>
          <div class="stat-label">AVG GHG</div>
          <div class="stat-unit">(kgCO₂e/ft²)</div>
          <div class="stat-sample" id="ghgSample"></div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgStar">--</div>
          <div class="stat-label">AVG ENERGY STAR®</div>
          <div class="stat-unit">(1-100)</div>
          <div class="stat-sample" id="starSample"></div>
        </div>
      </div>
      
      <div class="tabs">
        <button class="tab active" data-metric="eui">Energy (EUI)</button>
        <button class="tab" data-metric="wui">Water (WUI)</button>
        <button class="tab" data-metric="ghg">Emissions (GHG)</button>
        <button class="tab" data-metric="star">ENERGY STAR®</button>
      </div>
      
      <div class="filters">
        <div class="filter-section">
          <div class="filter-section-title">Location</div>
          
          <div class="filter-group">
            <label class="filter-label">Borough</label>
            <div class="checkbox-group" id="boroughFilter">
              <button class="checkbox-btn active" data-borough="">All</button>
              <button class="checkbox-btn" data-borough="Manhattan">Manhattan</button>
              <button class="checkbox-btn" data-borough="Brooklyn">Brooklyn</button>
              <button class="checkbox-btn" data-borough="Queens">Queens</button>
              <button class="checkbox-btn" data-borough="Bronx">Bronx</button>
              <button class="checkbox-btn" data-borough="Staten Island">Staten Island</button>
            </div>
          </div>
          
          <div class="filter-group">
            <label class="filter-label">Reporting Year</label>
            <select class="filter-select" id="yearFilter">
              <option value="2024">2024</option>
            </select>
          </div>
        </div>
        
        <div class="filter-section">
          <div class="filter-section-title">Building Characteristics</div>
          
          <div class="filter-group">
            <label class="filter-label">Year Built</label>
            <div class="range-values">
              <input type="text" class="range-input" id="yearBuiltMinInput" value="--">
              <input type="text" class="range-input" id="yearBuiltMaxInput" value="--">
            </div>
            <div class="dual-range">
              <div class="track" id="yearBuiltTrack"></div>
              <input type="range" id="yearBuiltMin" min="1800" max="2025" value="1800">
              <input type="range" id="yearBuiltMax" min="1800" max="2025" value="2025">
            </div>
          </div>
          
          <div class="filter-group">
            <label class="filter-label">Floor Area (ft²)</label>
            <div class="range-values">
              <input type="text" class="range-input" id="floorAreaMinInput" value="--">
              <input type="text" class="range-input" id="floorAreaMaxInput" value="--">
            </div>
            <div class="dual-range">
              <div class="track" id="floorAreaTrack"></div>
              <input type="range" id="floorAreaMin" min="0" max="15000000" step="10000" value="0">
              <input type="range" id="floorAreaMax" min="0" max="15000000" step="10000" value="15000000">
            </div>
          </div>
        </div>
        
        <div class="filter-section">
          <div class="filter-section-title">Performance Metrics</div>
          
          <div class="filter-group">
            <label class="filter-label">ENERGY STAR® Rating</label>
            <div class="range-values">
              <input type="text" class="range-input" id="starMinInput" value="1">
              <input type="text" class="range-input" id="starMaxInput" value="100">
            </div>
            <div class="dual-range">
              <div class="track" id="starTrack"></div>
              <input type="range" id="starMin" min="1" max="100" value="1">
              <input type="range" id="starMax" min="1" max="100" value="100">
            </div>
          </div>
          
          <div class="toggle-row">
            <span class="filter-label" style="margin:0">Only ENERGY STAR® Rated</span>
            <div class="toggle" id="energyStarToggle"></div>
          </div>
        </div>
        
        <div class="filter-section">
          <div class="filter-section-title">Property Types</div>
          <div class="property-type-list" id="propertyTypes"></div>
        </div>
      </div>
      
      <div class="footer">
        <div class="footer-stats">
          <span class="footer-stats-text">Showing</span>
          <span class="footer-stats-value">
            <span id="filteredCount">0</span> of <span id="totalCount">0</span> buildings
          </span>
        </div>
        <div class="footer-note" id="footerNote"></div>
        <div class="buttons">
          <button class="btn btn-secondary" id="downloadBtn">Export Data</button>
          <button class="btn btn-primary" id="resetBtn">Reset All</button>
        </div>
        
        <div class="copyright">
          © 2026 <a href="https://github.com/dvd1587" target="_blank">Prateek Dwivedi</a>
        </div>
      </div>
    </div>
    
    <!-- Map Area -->
    <div class="map-area">
      <div class="search-bar">
        <div class="search-wrapper">
          <svg class="search-icon" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
          </svg>
          <input type="text" class="search-input" id="searchInput" placeholder="Search by building name or address...">
        </div>
      </div>
      
      <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading NYC Building Data...</div>
        <div class="loading-subtext" id="loadingSubtext">Connecting to NYC Open Data API</div>
      </div>
      
      <div id="map" style="display:none"></div>
      
      <div class="legend" id="legend" style="display:none">
        <div class="legend-title" id="legendTitle">Source EUI (kBtu/ft²)</div>
        <div class="legend-bar">
          <span class="legend-label" id="legendLowLabel">Good</span>
          <div class="legend-gradient" id="legendGradient"></div>
          <span class="legend-label" id="legendHighLabel">Poor</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Application Script (ES Module) -->
  <script type="module" src="js/app.js"></script>
</body>
</html>
